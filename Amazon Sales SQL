CREATE DATABASE SALES;
USE SALES;

DROP TABLE SALES;

CREATE OR REPLACE TABLE Sales
(
REGION VARCHAR(40),
COUNTRY VARCHAR(40),
ITEM_TYPE VARCHAR(40),
SALES_CHANNEL VARCHAR(40),
ORDER_PRIORITY VARCHAR(30),
ORDER_DATE DATE,
ORDERID INT,
SHIP_DATE DATE,
UNIT_SOLD INT,
UNIT_PRICE FLOAT,
UNIT_COST FLOAT,
TOTAL_REVENUE FLOAT,
TOTAL_COST FLOAT,
TOTAL_PROFIT FLOAT
);

SELECT * FROM Sales;

create or replace file format SAL
    type = 'csv' 
    compression = 'none' 
    field_delimiter = ','
    field_optionally_enclosed_by = 'none'
    skip_header = 1 ; 

CREATE OR REPLACE STORAGE INTEGRATION AMAZON
TYPE=EXTERNAL_STAGE
STORAGE_PROVIDER=S3
ENABLED=TRUE
STORAGE_AWS_ROLE_ARN='arn:aws:iam::233625266009:role/amazonrole'
STORAGE_ALLOWED_LOCATIONS=('s3://amazonpw/');

DESC INTEGRATION AMAZON;

CREATE OR REPLACE STAGE AMAZON_SALES
URL='s3://amazonpw'
FILE_FORMAT=SAL
STORAGE_INTEGRATION=AMAZON;

LIST @AMAZON_SALES;

SHOW STAGES;

SHOW PIPES;

CREATE OR REPLACE PIPE AMAZON_PIPE AUTO_INGEST=TRUE AS 
COPY INTO SALES.PUBLIC.SALES
FROM '@AMAZON_SALES/Sales/'
FILE_FORMAT=SAL;

ALTER PIPE AMAZON_PIPE REFRESH;

SELECT * FROM Sales;

CREATE OR REPLACE TABLE COPY_SALES
AS SELECT*FROM SALES;

SELECT * FROM COPY_SALES;

SELECT DISTINCT ORDER_PRIORITY FROM COPY_SALES;



UPDATE SALES 
SET ORDER_PRIORITY='High_Priority'
where ORDER_PRIORITY='H';

UPDATE COPY_SALES
SET ORDER_PRIORITY='Low_Priority'
where ORDER_PRIORITY='L';


UPDATE COPY_SALES
SET ORDER_PRIORITY='Standard_Priority'
where ORDER_PRIORITY='M';

UPDATE COPY_SALES
SET ORDER_PRIORITY='Critical'
where ORDER_PRIORITY='C';

SELECT * FROM SALES_NEW;











